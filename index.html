<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>Pricing example</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.0/css/bootstrap-slider.min.css" crossorigin="anonymous">
    
    <!-- Custom styles for this template -->
    <link href="pricing.css" rel="stylesheet">
  </head>

  <body>
    <div class="d-flex flex-column flex-md-row align-items-center p-3 px-md-4 mb-3 bg-white border-bottom box-shadow">
      <h5 class="my-0 mr-md-auto font-weight-normal">Company name</h5>
      <nav class="my-2 my-md-0 mr-md-3">
        <a class="p-2 text-dark" href="#">Features</a>
        <a class="p-2 text-dark" href="#">Customers</a>
        <a class="p-2 text-dark" href="#">Blog</a>
        <a class="p-2 text-dark" href="#">Sign in</a>
        </nav>
      <a class="btn btn-outline-primary" href="#">Sign up</a>
    </div>

    <div class="pricing-header px-3 py-3 pt-md-5 pb-md-4 mx-auto text-center">
      <h1 class="display-4">Pricing</h1>
      <p class="lead">Amazing new pricing model for Usersnap.</p>
      <div class="container">
        <div class="row">
          <div class="col-6">
              <input id="ex6" type="text"/>
          </div>
          <div class="col-4 justify-content-end">
              <span id="ex6CurrentSliderValLabel" class="float-right"> Users (à $<span id="priceUser"></span>): </span>
          </div>
          <div class="col-sm">
              <span id="ex6SliderVal" class="float-left">0</span>
          </div>
        </div>
        <div class="row">
            <div class="col-6">
                <input id="ex7" type="text"/>
            </div>
            <div class="col-4 justify-content-end">
                <span id="ex7CurrentSliderValLabel" class="float-right"> Projects (à $<span id="priceProject"></span>): </span>
            </div>
            <div class="col-sm">
                <span id="ex7SliderVal" class="float-left">0</span>
            </div>
        </div>
        <div class="row">
          <div class="col-6">
              <input id="ex8" type="text"/>
          </div>
          <div class="col-4 justify-content-end">
              <span id="ex8CurrentSliderValLabel" class="float-right"> Page views (à $<span id="pricePageview"></span>): </span>
          </div>
          <div class="col-sm">
              <span id="ex8SliderVal" class="float-left">0</span>
          </div>
        </div>
      </div>
      <p>&nbsp;</p>
      <h1>
        <span id="priceLabel"> Price: <span id="price">0</span></span></p>
      </h1>
    
    </div>

    <div class="container-fluid">
      <div class="card-deck mb-4 text-center">
        <div id="card1" class="card mb-3 box-shadow">
          <div class="card-header">
            <h4 class="my-0 font-weight-normal">Option 1</h4>
          </div>
          <div id="package1" class="card-body">
            <h1 class="card-title pricing-card-title"><span id="packagePrice1"></span> <small>/ mo</small></h1>
            <ul class="list-unstyled mt-3 mb-4">
              <li><span class='users'>0</span> users</li>
              <li><span class='projects'>0</span> active projects</li>
              <li><span class='pageviews'>0</span> pageviews</li>
            </ul>
            <ul class="features list-unstyled mt-3 mb-4">
            </ul>
            </div>
          <div class="card-footer">
            <button id="select1" type="button" class="btn btn-lg btn-block btn-outline-primary">Select</button>
          </div>
        </div>
        <div id="card2" class="card mb-3 box-shadow">
          <div class="card-header">
            <h4 class="my-0 font-weight-normal">Option 2</h4>
          </div>
          <div id="package2" class="card-body">
            <h1 class="card-title pricing-card-title"><span id="packagePrice2"></span> <small>/ mo</small></h1>
            <ul class="list-unstyled mt-3 mb-4">
              <li><span class='users'>0</span> users</li>
              <li><span class='projects'>0</span> active projects</li>
              <li><span class='pageviews'>0</span> pageviews</li>
            </ul>
            <ul class="features list-unstyled mt-3 mb-4">
              </ul>
            </div>
          <div class="card-footer">
              <button id="select2" type="button" class="btn btn-lg btn-block btn-outline-primary">Select</button>
          </div>
        </div>
        <div id="card3" class="card mb-3 box-shadow">
          <div class="card-header">
            <h4 class="my-0 font-weight-normal">Option 3</h4>
          </div>
          <div id="package3" class="card-body bg-success text-white">
            <h1 class="card-title pricing-card-title"><span id="packagePrice3"></span> <small>/ mo</small></h1>
            <ul class="list-unstyled mt-3 mb-4">
                <li><span class='users'>0</span> users</li>
                <li><span class='projects'>0</span> active projects</li>
                <li><span class='pageviews'>0</span> pageviews</li>
                <li>custom branding</li>
            </ul>
            <ul class="features list-unstyled mt-3 mb-4">
            </ul>
            </div>
          <div class="card-footer">
            <button id="select3" type="button" class="btn btn-lg btn-block btn-outline-primary">Select</button>
          </div>
        </div>
        <div id="card4" class="card mb-3 box-shadow">
          <div class="card-header">
            <h4 class="my-0 font-weight-normal">Option 4</h4>
          </div>
          <div id="package4" class="card-body">
            <h1 class="card-title pricing-card-title"><small>on demand</small></h1>
            <ul class="list-unstyled mt-3 mb-4">
              <li>unlimited users</li>
              <li>unlimited projects</li>
              <li>unlimited pageviews</li>
            </ul>
            <ul class="features list-unstyled mt-3 mb-4">
              <li>all features</li>
            </ul>
          </div>
          <div class="card-footer">
            <button type="button" class="btn btn-lg btn-block btn-primary">Contact us</button>
          </div>
        </div>
      </div>
    </div>

    <div class="container">
      <footer class="pt-4 my-md-5 pt-md-5 border-top">
        <div class="row">
          <div class="col-12 col-md">
            <small class="d-block mb-3 text-muted">&copy; Usersnap 2019</small>
          </div>
          <div class="col-6 col-md">
            <h5>Features</h5>
            <ul class="list-unstyled text-small">
              <li><a class="text-muted" href="#">Cool stuff</a></li>
              <li><a class="text-muted" href="#">Random feature</a></li>
              <li><a class="text-muted" href="#">Team feature</a></li>
              <li><a class="text-muted" href="#">Stuff for developers</a></li>
              <li><a class="text-muted" href="#">Another one</a></li>
              <li><a class="text-muted" href="#">Last time</a></li>
            </ul>
          </div>
          <div class="col-6 col-md">
            <h5>Resources</h5>
            <ul class="list-unstyled text-small">
              <li><a class="text-muted" href="#">Resource</a></li>
              <li><a class="text-muted" href="#">Resource name</a></li>
              <li><a class="text-muted" href="#">Another resource</a></li>
              <li><a class="text-muted" href="#">Final resource</a></li>
            </ul>
          </div>
          <div class="col-6 col-md">
            <h5>About</h5>
            <ul class="list-unstyled text-small">
              <li><a class="text-muted" href="#">Team</a></li>
              <li><a class="text-muted" href="#">Locations</a></li>
              <li><a class="text-muted" href="#">Privacy</a></li>
              <li><a class="text-muted" href="#">Terms</a></li>
            </ul>
          </div>
        </div>
        <form>
          <div class="form-group">
              <label for="exampleFormControlTextarea1">Pricing model</label>
              <textarea id="config" class="form-control" id="exampleFormControlTextarea1" rows="15"></textarea>
              <button id="update" type="button" class="btn btn-primary">Update</button>
            </div>
        </form>    
      </footer>
    </div>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://getbootstrap.com/docs/4.0/assets/js/vendor/popper.min.js"></script>
    <script src="https://getbootstrap.com/docs/4.0/dist/js/bootstrap.min.js"></script>
    <script src="https://getbootstrap.com/docs/4.0/assets/js/vendor/holder.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-slider/10.6.0/bootstrap-slider.min.js"></script>

    <script>
      Holder.addTheme('thumb', {
        bg: '#55595c',
        fg: '#eceeef',
        text: 'Thumbnail'
      });
      var users = 0;
      var projects = 0;
      var pageviews = 0;
      var priceUser = 10;
      var priceProject = 10;
      var pricePageview = 0.001;
      // use 10,000,000 to get "unlimited"
      var packages = [{
        price: 10,
        users: 2,
        projects: 5,
        pageviews: 50000
      }, {
        price: 50,
        users: 10,
        projects: 50,
        pageviews: 200000
      }, {
        price: 200,
        users: 50,
        projects: 200,
        pageviews: 1000000
      }, {
        price: 10000000, // on demand
        users: 10000000, // unlimited
        projects: 10000000, // unlimited
        pageviews: 10000000 // unlimited
      }];
      var selectedPackage = -1;

      function updateUnitPrice() {
        updatePrice();
      }

      function updatePrice() {
        
        let dynamicPrice = Number.parseInt(users * priceUser + projects * priceProject + pageviews * pricePageview);
        let packagePrice = [];
        let price = 0;
        let suitablePackage = 3;
        let bestPackage = 3;

        // find a package that would fit
        for (let index = 2; index >= 0; index--) {
          if (users <= packages[index].users &&
            projects <= packages[index].projects &&
            pageviews <= packages[index].pageviews) {
            suitablePackage = index;
          }
        }
        price = packages[suitablePackage].price;
        bestPackage = suitablePackage;

        // find a smaller package with dynamic paraters that would be cheaper
        for (let index = 0; index < 3; index++) {
          let p = packages[index];
          let total = p.price;
          let packagePriceUser = p.priceUser || priceUser;
          let packagePriceProject = p.priceProject || priceProject;
          let packagePricePageview = p.pricePageview || pricePageview;
          if ( p.users < users) {
            total += (users - p.users) * packagePriceUser;
          }
          if ( p.projects < projects) {
            total += (projects - p.projects) * packagePriceProject;
          }
          if ( p.pageviews < pageviews) {
            total += (pageviews - p.pageviews) * packagePricePageview;
          }
          packagePrice[index] = total;

          if (total < price) {
            bestPackage = index;
            price = total;
          }
        }

        // use selected package
        if (selectedPackage >= 0 ){
          bestPackage = selectedPackage;
          price = packagePrice[bestPackage];
        }

        $("#priceUser").text(priceUser);
        $("#priceProject").text(priceProject);
        $("#pricePageview").text(pricePageview);
        if (packages[bestPackage].priceUser) {
            $("#priceUser").text(packages[bestPackage].priceUser);
        }
        if (packages[bestPackage].priceProject) {
            $("#priceProject").text(packages[bestPackage].priceProject);
        }
        if (packages[bestPackage].pricePageview) {
            $("#pricePageview").text(packages[bestPackage].pricePageview);
        }

        $("#price").text(price);
        $('.card-body').removeClass("bg-success text-white");
        $('#package' + (bestPackage + 1) + '.card-body').addClass("bg-success text-white");
      } 

      function formatNumber(n) {
        if (n >= 10000000) {
          return "unlimited";
        }
        return n.toLocaleString('en');
      }

      function updatePackages() {
        $("#packagePrice1").text(packages[0].price);
        $("#packagePrice2").text(packages[1].price);
        $("#packagePrice3").text(packages[2].price);

        for (let index = 0; index < 3; index++) {
          let p = packages[index];
          $("#card" + (index + 1) + "" ).toggle(!p.hide);
          $("#package" + (index + 1) + " .features li" ).remove();
          if (p.priceUser) {
            $("#package" + (index + 1) + " .features" ).append("<li> $" + p.priceUser + " per user</li>");
          }
          if (p.priceProject) {
            $("#package" + (index + 1) + " .features" ).append("<li> $" + p.priceProject + " per project</li>");
          }
          if (p.pricePageview) {
            $("#package" + (index + 1) + " .features" ).append("<li> $" + p.pricePageview + " per page view</li>");
          }
          if (p.features && Array.isArray(p.features)) {
            p.features.forEach(function(feature) {
              $("#package" + (index + 1) + " .features" ).append("<li>" + feature + "</li>");
            });
          }
          $("#package" + (index + 1) + " .users" ).text(formatNumber(p.users));
          $("#package" + (index + 1) + " .projects" ).text(formatNumber(p.projects));
          $("#package" + (index + 1) + " .pageviews" ).text(formatNumber(p.pageviews));
        }
      }

      function writeConfig() { 
        let config = {
          priceUser: priceUser,
          priceProject: priceProject,
          pricePageview: pricePageview,
          packages: packages
        }
        $("#config").val(JSON.stringify(config, null, 4));
      }

      function readConfig(config) {
        if (!config) {
          return;
        }
        if (config.priceUser) {
          priceUser = config.priceUser;
        }
        if (config.priceProject) {
          priceProject = config.priceProject;
        }
        if (config.pricePageview) {
          pricePageview = config.pricePageview;
        }
        if (config.packages && Array.isArray(config.packages)) {
          packages = config.packages;
        }
        updatePackages();
      }

      // do things now
      
      try {
        let url = new URL(window.location.href);
        let urlConfig = url.searchParams.get("config");
        let config = JSON.parse(decodeURIComponent(urlConfig));
        readConfig(config);
        writeConfig();
      } catch (error) {
        alert(error);
      }

      $("#update").on("click", function() {
        let configStr = '';
        try {
          configStr = $("#config").val();
          readConfig(JSON.parse(configStr));
          var url = new URL(window.location.href);
          url.searchParams.set('config', encodeURIComponent(configStr));
          window.location.href = url.href;
          return false;
        } catch (error) {
          alert(error);
        }
      });

      $("#select1").on("click", function() {
        $(".card-footer .btn-outline-primary").text("Select");
        if (selectedPackage === 0) {
          selectedPackage = -1;
        } else {
          $("#select1").text("Unselect");
          selectedPackage = 0;
        }
        updatePrice();
      });
      $("#select2").on("click", function() {
        $(".card-footer .btn-outline-primary").text("Select");
        if (selectedPackage === 1) {
          selectedPackage = -1;
        } else {
          $("#select2").text("Unselect");
          selectedPackage = 1;
        }
        updatePrice();
      });
      $("#select3").on("click", function() {
        $(".card-footer .btn-outline-primary").text("Select");
        if (selectedPackage === 2) {
          selectedPackage = -1;
        } else {
          $("#select3").text("Unselect");
          selectedPackage = 2;
        }
        updatePrice();
      });

      $("#ex6").slider({
        value: users,
        min: 0,
        max: 200,
        scale: 'logarithmic',
        step: 1
      });
      $("#ex6").on("slide", function(slideEvt) {
        users = parseInt(slideEvt.value);
        $("#ex6SliderVal").text(slideEvt.value);
        updatePrice();
      });
      $("#ex7").slider({
        value: projects,
        min: 0,
        max: 200,
        scale: 'logarithmic',
        step: 1
      });
      $("#ex7").on("slide", function(slideEvt) {
        projects = parseInt(slideEvt.value);
        $("#ex7SliderVal").text(slideEvt.value);
        updatePrice();
      });
      $("#ex8").slider({
        value: pageviews,
        min: 0,
        max: 1000000,
        step: 5000
      });
      $("#ex8").on("slide", function(slideEvt) {
        pageviews = parseInt(slideEvt.value);
        $("#ex8SliderVal").text(slideEvt.value);
        updatePrice();
      });

      $("#ex6SliderVal").text(users);
      $("#ex7SliderVal").text(projects);
      $("#ex8SliderVal").text(pageviews);
      
      updatePackages();
      updatePrice();
      writeConfig();
      
    </script>
  </body>
</html>
